// nextflow.config - Final version for pre-prepared databases

// ====================================================================================
// ==                            Pipeline Parameters                                 ==
// ====================================================================================
params {
    // --- Input/Output ---
    // The input FASTA file MUST be provided by the user on the command line.
    // e.g. nextflow run main.nf --input /path/to/your/transcripts.fasta
    input       = false 
    
    // The main directory where all output files will be saved.
    outdir      = "${projectDir}/output"

    // --- Prepared Database Locations ---
    // This path points to your 'raw_database' directory which now contains all PREPARED databases.
    prepared_db_dir  = "${projectDir}/raw_database" 

    // --- Paths to specific PREPARED database files ---
    db_sprot_dmnd   = "${params.prepared_db_dir}/uniprot_sprot.dmnd"
    db_trembl_dmnd  = "${params.prepared_db_dir}/uniprot_trembl.dmnd"
    db_uniref90_dmnd= "${params.prepared_db_dir}/uniref90.dmnd"
    // InterProScan will find its data directory automatically if we launch it correctly
    // We will manage its properties within the process itself.
    db_eggnog_dir   = "${params.prepared_db_dir}/eggnog_db"
    db_rfam_cm      = "${params.prepared_db_dir}/Rfam.cm"
    
    // --- Tool-specific Parameters ---
    transdecoder_min_len = 100
    diamond_evalue       = 1e-5
}

// ====================================================================================
// ==              Executor, Environment, and Profile Configuration                  ==
// ====================================================================================
// (This section is correct and remains unchanged)
process {
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries    = 2
    maxErrors     = '-1'

    withLabel: 'low_cpu' { cpus = 2; memory = '8.GB' }
    withLabel: 'medium_cpu' { cpus = 8; memory = '32.GB' }
    withLabel: 'high_cpu' { cpus = 24; memory = '96.GB' }
    withLabel: 'super_high_cpu' { cpus = 48; memory = '192.GB' }
}

conda {
    enabled            = true
    useMamba           = true
    createTimeout      = '20 min'
}

profiles {
    standard {
        process.executor = 'local'
    }
    cluster {
        process.executor = 'slurm'
    }
}
